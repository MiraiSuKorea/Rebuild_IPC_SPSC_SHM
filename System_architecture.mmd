---
config:
  layout: elk
---
flowchart LR
 subgraph subGraph0["External APIs"]
    direction LR
        API_BI["Binance WS API"]
        API_BG_PUB["Bitget Public WS"]
        API_BG_PRIV["Bitget Private WS/REST"]
  end
 subgraph subGraph1["Data Workers"]
    direction TB
        W_OBI["Binance Alpha Maker<br>cython_module"]
        W_OFI["Binance Regime Maker<br>cython_module"]
        W_BGBOOK["Book Maker<br>orderbook_maker_cython"]
        W_BGPOS["Bitget Private WS<br>bitget_private_ws_cython"]
  end
 subgraph subGraph2["Shared Memory Rings (IPC)"]
    direction TB
        R_OBI["RING_2"]
        R_OFI["RING_3"]
        R_BGBOOK["RING_4"]
        R_BGPOS["RING_1"]
        R_ORD["RING_ORD<br>Commands"]
        R_FILL["RING_FILL<br>Fills"]
        R_STATUS["RING_STATUS<br>Status"]
  end
 subgraph subGraph3["Strategy"]
        S_ENGINE["DirectionalMMEngine (Cython)<br>3-Factor Model"]
  end
 subgraph subGraph4["OMS"]
        O_OMS["Order Management System (Cython)<br>Auto-Cancel &amp; State Logic"]
  end
    API_BI --> W_OBI & W_OFI
    W_OBI --> R_OBI
    W_OFI --> R_OFI
    API_BG_PUB --> W_BGBOOK
    W_BGBOOK --> R_BGBOOK
    API_BG_PRIV --> W_BGPOS
    W_BGPOS --> R_BGPOS
    R_OBI -- Read --> S_ENGINE
    R_OFI -- Read --> S_ENGINE
    R_BGBOOK -- Read --> S_ENGINE
    R_BGPOS -- Read --> S_ENGINE
    S_ENGINE -- [Cancel/Place] Commands --> R_ORD
    R_ORD -- Read --> O_OMS
    O_OMS -- Send to Bitget --> API_BG_PRIV
    API_BG_PRIV -- Get WS Updates --> O_OMS
    O_OMS -- Write Fills --> R_FILL
    O_OMS -- Write Status --> R_STATUS
     API_BI:::api
     API_BG_PUB:::api
     API_BG_PRIV:::api
     W_OBI:::process
     W_OFI:::process
     W_BGBOOK:::process
     W_BGPOS:::process
     R_OBI:::ring
     R_OFI:::ring
     R_BGBOOK:::ring
     R_BGPOS:::ring
     R_ORD:::ring
     R_FILL:::ring
     R_STATUS:::ring
     S_ENGINE:::process
     O_OMS:::process
    classDef api fill:#FFF,stroke:#D00,stroke-width:2px
    classDef process fill:#F9F,stroke:#333,stroke-width:2px
    classDef ring fill:#FFFFE0,stroke:#333,stroke-width:1px,color:#333
